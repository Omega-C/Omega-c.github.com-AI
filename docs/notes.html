

<html>

<head>
	<title>Notes</title>
	<!--This is just a rip off of the console thing I did, but I want something I can jot notes down on nonetheless. Progress will be had later on with replacements and all that jazz.-->
	<style>
	* {
		margin: 0;
		padding: 0;
		outline: 0px solid transparent;
	}
	
	.popup {
		position:absolute;
		width: 30%;
		height: 40%;
		border: solid black;
		background-color:white;
		border-width: 2px;
		display: none;
		z-index: 9;
		resize: both;
		overflow: hidden;
	}
	
	#popupheader, #popup2header, #popup3header {
		cursor: move;
		z-index: 10 !important;
	}
	
	#popup>textarea{
		resize: none;
		width:98%;
		height:78%;
		margin:1%;
	}
	#popup2>textarea {
		resize: none;
		width:98%;
		height:92%;
		margin:1%;
	}
	#popup>button, #popup3>button {
		width:98%;
		height:10%;
		margin:1%;
	}
	
	#main {
		float: left;
		font-family: Consolas, monaco, monospace;
		background-color: #FFFFFF;
		color: black;
		height: calc(95% - 11px);
		width: calc(100% - 10px);
		padding:5px;
		display: inline-block;
		overflow-y: auto;
		white-space: -moz-pre-wrap;
		white-space: -pre-wrap;
		white-space: -o-pre-wrap;
		white-space: pre-wrap;
		word-wrap: break-word;
		font-size: 15px;
	}
	
	button {
		color: #FFFFFF;
		border-radius: 0px;
		font-size: 99%;
		float: left;
		margin: 1px;
		padding: 0px;
		width: calc(33.33% - 2px);
		height: 5%;
		display: inline-block;
		outline: none;
		border-width: 0px;
		background-color: #7d7e82;
	}
	
	button:active {
		background-color: #5d5f63;
	}
	
	html, body {
		height: 100%;
		margin: 0;
		padding: 0;
		width: 100%;
	}
	</style>
</head>

<body><pre id="main" spellcheck=false contenteditable></pre>
	<div id="popup2" class="popup"><div id="popup2header">Notes</div><textarea id="files" readonly placeholder="No Files..."></textarea></div>
	<div id="popup3" class="popup"><div id="popup3header">Other Options (WIP)</div><button onclick="toggleSpellcheck();">Toggle SpellCheck</button></div>
	<div id="popup" class="popup"><div id="popupheader">Replacements</div><textarea id="replacements" placeholder="JSON for replacements">{"-->":"→","/\\":"∧","\\/":"∨","~!":"¬","<→":"↔","==>":"⇒","--U":"⊃","<⇒":"⇔","=={⇔}":"≡","=={↔}":"≡","D{set}":"𝔻"}</textarea><button onclick="saveParameters();">Apply</button></div>
	<button onclick="LoadButton();">Load</button>
	<button onclick="SaveButton();">Save</button>
	<button onclick="download();">Download</button>

	<script>
	/*yoink, from https://www.w3schools.com/howto/howto_js_draggable.asp*/
	
	dragElement(document.getElementById("popup"));
	dragElement(document.getElementById("popup2"));
	dragElement(document.getElementById("popup3"));
	function dragElement(elmnt) {
	  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
	  if (document.getElementById(elmnt.id + "header")) {
	    document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown
	  } else {
	    elmnt.onmousedown = dragMouseDown
	  };
	  function dragMouseDown(e) {
	    e = e || window.event;
	    e.preventDefault();
	    pos3 = e.clientX;
	    pos4 = e.clientY;
	    document.onmouseup = closeDragElement;
	    document.onmousemove = elementDrag
	  };
	  function elementDrag(e) {
	    e = e || window.event;
	    e.preventDefault();
	    pos1 = pos3 - e.clientX;
	    pos2 = pos4 - e.clientY;
	    pos3 = e.clientX;
	    pos4 = e.clientY;
	    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
	    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px"
	  };
	  function closeDragElement() {
	    document.onmouseup = null;
	    document.onmousemove = null
	  }
	};

	/*now my code*/
	
	if(localStorage.getItem("savednotes") != null) {
		document.getElementById("main").innerHTML = localStorage.getItem("savednotes")
	};
		
	if(localStorage.getItem("rewrites") != null) {
		rewritePresets = localStorage.getItem("rewrites")
	} else {
		rewritePresets = ""
	};
		
	try {
		if(JSON.parse(localStorage.getItem("saves")) === null) {
			localStorage.setItem("saves", JSON.stringify({}))
		}
	} catch(e) {
		console.log("rewriting data I think.");
		localStorage.setItem("saves", JSON.stringify({}))
	};
		
	function toggleSpellcheck() {
		if (document.getElementById("main").getAttribute("spellcheck")=="true") {
			document.getElementById("main").setAttribute("spellcheck", "false")
		} else {
			document.getElementById("main").setAttribute("spellcheck", "true")
		}
	};
	
	toggle("popup","block");
	toggle("popup2","block");
	toggle("popup3","block");
	
	function saveKeep() {
		localStorage.setItem("savednotes", document.getElementById("main").innerHTML)
	};
	
	function listFiles() {
		let text=Object.keys(JSON.parse(localStorage.getItem("saves"))).join(", ");
		document.getElementById("files").value=text
	};
	
	listFiles();
		
	function saveParameters() {
		try {
			let replacementParameters=JSON.parse(document.getElementById("replacements").value);
			document.getElementById("main").normalize();
			for (const a in replacementParameters) {
				try {
					document.getElementById("main").innerText=document.getElementById("main").innerText.replaceAll(RegExp(a.replaceAll("\\","\\\\")),replacementParameters[a]);
				} catch(e) {
					document.getElementById("main").innerText=document.getElementById("main").innerText.replaceAll(a,replacementParameters[a]);
				}
			};
			saveKeep()
		} catch(e) {alert("could not parse JSON");alert(e)}
	};
		
	document.getElementById("main").addEventListener("paste", function(e) {
		e.preventDefault();
		var text = (e.originalEvent || e).clipboardData.getData('text/plain');
		var element = document.createElement("div");
		element.innerText = text;
		var text = element.innerHTML;
		document.execCommand("insertHTML", false, text)
	});

	function SaveButton() {
		let fname = prompt("file name");
		if(fname == "" || fname == null) {
			return(false)
		};
		let files = JSON.parse(localStorage.getItem("saves"));
		files[fname] = document.getElementById("main").innerHTML;
		localStorage.setItem("saves", JSON.stringify(files));
		listFiles()
	};

	function LoadButton() {
		let fname = prompt("file name");
		if(fname == "" || fname == null) {
			return(false)
		};
		let files = JSON.parse(localStorage.getItem("saves"));
		if(!(fname in files)) {
			alert(`${fname} not found in saves`)
		} else {
			document.getElementById("main").innerHTML = files[fname]
		};
		saveKeep()
	};

	function download() {
		let a=document.createElement("a");
		a.href=`data:text/html;charset=utf-8,${encodeURIComponent(document.getElementById("main").textContent)}`;
		a.download=prompt("Name of Note: ")+".txt";
		document.body.appendChild(a);
		a.click();
		document.body.removeChild(a);
	};
	
	document.getElementById("main").addEventListener("input", function(e) {
		saveKeep();
		return(false)
	});
	
	document.getElementById("main").addEventListener("keydown", function replaceTab(event, element = document.activeElement) {
		if(event.key === "Tab") {
			event.preventDefault();
			let selection = window.getSelection();
			let range = selection.getRangeAt(0);
			range.deleteContents();
			let node = document.createTextNode("	");
			range.insertNode(node);
			selection.modify("move", "right", "character")
		};
		if (event.key === "Enter") {
			event.preventDefault();
			let selection = window.getSelection();
			let range = selection.getRangeAt(0);
			range.deleteContents();
			let node = document.createElement("br");
			range.insertNode(node);
			selection.modify("move", "right", "character")
		}
	});
	
	document.addEventListener("keyup", function replaceTab(event) {
		if (event.ctrlKey && event.which==81) {
			toggle("popup","block");
			toggle("popup2","block");
			toggle("popup3","block")
		}
	});

	function toggle(elementID,disp) {
		if (document.getElementById(elementID).style.display=="none") {
			document.getElementById(elementID).style.display=disp
		}
		else {
			document.getElementById(elementID).style.display="none"
		}
	}
	</script>
</body>

</html>
